<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<form onsubmit="return false">
<span>First Name</span>
<br>
<input type="text" required id="name" placeholder="First Name"/>
<br>
<span>Last Name</span>
<br>
<input type="text" required id="last" placeholder="Last Name"/>
<br>
<span>E-Mail</span>
<br>
<input type="email" required id="mail" placeholder="E-Mail Adress"/>
<br>
    <span>Username</span>
    <br>
<input type="text" required id="Username" placeholder="Username"/>
<br>
<span>Password</span>
<br>
<input type="password" required id="Pass" placeholder="Password"/>
    <br>

<span>Team Name</span>
<br>
<input type="text" id="Team" placeholder="Team Name">
<br>
    <span>Upload Profile Picture</span>
<br>
<input type="file" accept="image/*" id="test" />
    <br>
<button type="submit" id="Submit">Submit</button>
    <br>
</form>
<script src="/jquery.js"></script>
<script>
    const $Button = $("#Submit");
    const $name = $('#name');
    const $Lname = $('#last');
    const $Email = $('#mail');
    const $Username = $('#Username');
    const $Pass = $('#Pass');
    const $Team = $('#Team');
    const Input = $("#test");
    $Button.on("click", function(e) {
        const name = $name.val().length <= 1 ? alert("Length of your name must be at least 2 characters") : $name.val();
        const Lname = $Lname.val().length <= 1 ? alert("Length of your Last name must be at least 2 characters"): $Lname.val();
        const Email = $Email.val().length <= 1 ? alert("Length of your E-mail must be at least 2 characters"): $Email.val();
        const Username = $Username.val().length < 6 ? alert("Length of your Username must be at least 6 characters"):$Username.val();
        const Pass = $Pass.val().length <= 6 ? alert("Length of your Password must be at least 6 characters") : $Pass.val();
        const Team = $Team.val();
        const IMG = Input[0].files;
        const form = new FormData();
        console.log(Lname);
        for (let i = 0; i < IMG.length; i++) {
            form.append("image", IMG[i]);
        }
        if(name === undefined || Lname === undefined || Email === undefined || Email.indexOf('@') <= 0 || Username === undefined || Pass === undefined){
            alert('Please complete the form properly');
        }
        else {
            $.ajax({
                url: "/text",
                type: 'post',
                data: JSON.stringify({
                    firstName : name,
                    lastName : Lname,
                    email : Email,
                    team : Team,
                    username : Username,
                    password : Pass
                }),

                contentType: 'application/json',
                success: function (e) {
                    if(e==="user exists"){
                      console.log("Existing user");
                    }
                    else{
                    if (IMG.length != 0) {
                        $.ajax({
                            url: "/upload",
                            data: form,
                            processData: false,
                            contentType: false,
                            type: "POST",
                            success: function (e) {
                                console.log("Success");
                            },
                            error: function (err) {
                                console.log(err);
                                alert('User already exists');
                            }
                        })
                    }
                  }//end of else
                },
                error: function () {
                    console.log("Error while sending text");
                    alert('user exists');
                    location.reload();
                }
            })

        }
        //return false;
    })
</script>
</body>
</html>
