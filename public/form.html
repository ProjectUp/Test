<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<form onsubmit="return false">
    <label for="name">First Name</label>
    <br>
    <input type="text" required id="name" placeholder="First Name"/>
    <br>
    <label for="last">Last Name</label>
    <br>
    <input type="text" required id="last" placeholder="Last Name"/>
    <br>
    <label for="mail">E-Mail Adress</label>
    <br>
    <input type="email" required id="mail" placeholder="E-Mail Adress"/>
    <br>
    <label for="Username">Username</label>
    <br>
    <input type="text" required id="Username" placeholder="Username"/>
    <br>
    <label for="Pass">Password</label>
    <br>
    <input type="password" required id="Pass" placeholder="Password"/>
    <br>
    <label for="Team">Team Name</label>
    <br>
    <input type="text" id="Team" placeholder="Team Name">
    <br>
    <label for="images">Upload profile picture</label>
    <br>
    <input type="file" accept="image/*" id="images" />
    <br>
    <button type="submit" id="Submit">Submit</button>
    <br>
</form>
<script src="/jquery.js"></script>
<script>
    const $Button = $("#Submit");
    const $name = $('#name');
    const $Lname = $('#last');
    const $Email = $('#mail');
    const $Username = $('#Username');
    const $Pass = $('#Pass');
    const $Team = $('#Team');
    const Input = $("#images");
    $Button.on("click", function(e) {
        const name = $name.val().length <= 1 ? alert("Length of your name must be at least 2 characters") : $name.val();
        const Lname = $Lname.val().length <= 1 ? alert("Length of your Last name must be at least 2 characters"): $Lname.val();
        const Email = $Email.val().length <= 1 ? alert("Length of your E-mail must be at least 2 characters"): $Email.val();
        const Username = $Username.val().length < 6 ? alert("Length of your Username must be at least 6 characters"):$Username.val();
        const Pass = $Pass.val().length <= 6 ? alert("Length of your Password must be at least 6 characters") : $Pass.val();
        const Team = $Team.val();
        const IMG = Input[0].files;
        const form = new FormData();
        for (let i = 0; i < IMG.length; i++) {
            form.append("image", IMG[i]);
        }
        if(name === undefined || Lname === undefined || Email === undefined || Email.indexOf('@') <= 0 || Username === undefined || Pass === undefined){
            alert('Please complete the form properly');
        }
        else {
            $.ajax({
                url: "/text",
                type: 'post',
                data: JSON.stringify({
                    firstName : name,
                    lastName : Lname,
                    email : Email,
                    team : Team,
                    username : Username,
                    password : Pass
                }),
                contentType: 'application/json',
                success: function (e) {
                        if (IMG.length != 0) {
                            $.ajax({
                                url: "/upload",
                                data: form,
                                processData: false,
                                contentType: false,
                                type: "POST",
                                success: function (e) {
                                    console.log("Success");
                                    window.location = '/';
                                },
                                error: function (err) {
                                    console.log(err);
                                    alert('User already exists');
                                }
                            })
                        } else {
                            window.location = '/';
                        }
                    },
                error: function () {
                    alert('user exists');
                    window.location.reload();
                }
            })
        }
    })
</script>
</body>
</html>